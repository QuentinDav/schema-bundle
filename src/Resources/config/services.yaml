services:
  Qd\SchemaBundle\:
    resource: '../../'
    exclude:
      - '../../Resources/'
      - '../../Entity/'
      - '../../Dto/'
    autowire: true
    autoconfigure: true

  Qd\SchemaBundle\Controller\:
    resource: '../../Controller/'
    public: true
    autowire: true
    autoconfigure: true
    tags: ['controller.service_arguments']

  Qd\SchemaBundle\Service\:
    resource: '../../Service/'
    autowire: true
    autoconfigure: true
    public: false

  Qd\SchemaBundle\Command\:
    resource: '../../Command/'
    autowire: true
    autoconfigure: true
    public: true
    tags: ['console.command']

  # Natural Language to SQL services
  Qd\SchemaBundle\Service\NlToSql\CostEstimator:
    arguments:
      $warnThreshold: '%qd_schema.nl_to_sql.cost.warn_threshold%'
      $maxPerRequest: '%qd_schema.nl_to_sql.cost.max_per_request%'

  Qd\SchemaBundle\Service\NlToSql\NlQueryAnalyzer:
    autowire: true

  Qd\SchemaBundle\Service\NlToSql\PathFinder:
    autowire: true

  Qd\SchemaBundle\Service\NlToSql\PromptBuilder:
    autowire: true

  Qd\SchemaBundle\Service\NlToSql\Generator\LocalRuleBasedGenerator:
    autowire: true

  Qd\SchemaBundle\Service\NlToSql\Generator\SymfonyAiGenerator:
    autowire: true
    arguments:
      $aiPlatform: '@?qd_schema.ai_platform'  # Optional service, created by user
      $model: '%qd_schema.nl_to_sql.ai.model%'
      $maxTokens: '%qd_schema.nl_to_sql.ai.max_tokens%'
      $temperature: '%qd_schema.nl_to_sql.ai.temperature%'

  Qd\SchemaBundle\Service\NlToSql\NlToSqlOrchestrator:
    arguments:
      $localGenerator: '@Qd\SchemaBundle\Service\NlToSql\Generator\LocalRuleBasedGenerator'
      $aiGenerator: '@Qd\SchemaBundle\Service\NlToSql\Generator\SymfonyAiGenerator'
      $strategy: '%qd_schema.nl_to_sql.strategy%'
      $confidenceThreshold: '%qd_schema.nl_to_sql.confidence_threshold%'

  # Example AI Platform configuration (user should override this in their services.yaml)
  # Uncomment and configure based on your provider:
  #
  # For OpenAI:
  # qd_schema.ai_platform:
  #   class: Symfony\AI\Platform\OpenAi\Client
  #   factory: ['Symfony\AI\Platform\Bridge\OpenAi\PlatformFactory', 'create']
  #   arguments:
  #     - '%env(OPENAI_API_KEY)%'
  #     - '@?http_client'
  #
  # For Anthropic:
  # qd_schema.ai_platform:
  #   class: Symfony\AI\Platform\Anthropic\Client
  #   factory: ['Symfony\AI\Platform\Bridge\Anthropic\PlatformFactory', 'create']
  #   arguments:
  #     - '%env(ANTHROPIC_API_KEY)%'
  #     - '@?http_client'
